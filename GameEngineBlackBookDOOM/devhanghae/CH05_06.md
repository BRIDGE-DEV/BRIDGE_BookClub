# Doom CH5

1. float 계산
고정 소수점 산술의 사용
- 부동 소수점에 대해서만 생각해봤지 사실 고정 소수점을 제대로 생각해본 적이 없다.
- 지수부와 가수부로 유동 소수점으로 표현하는 부동 소수점이 아니라 정수와 소수 부분에 해당하는 비트를 따로 확정하여 사용하는 고정 소수점이 신박하게 다가왔다. 단순하고 속도가 빨라, 높은 정밀도가 필요없는 게임에는 정말 좋은 접근이라는 생각이 들었다.

2. 3D 렌더러와 BSP
둠이 렌더링하는 대상은 세그(seg), 평면(plane), 스프라이트(sprite) 세 가지다.
1) 세그먼트
- 이전 방식
   - Wolf3D식 레이캐스팅: 화면 칼럼마다 DDA‑레이 1개를 쏴서 첫 벽에 텍스처 슬라이스를 그린다.
이전 엔진에서는 섹터로 구분되어 있는 영역 중에서 양면 선을 찾아, 재귀적으로 섹터를 그림.
분할 된 섹터를 그리기 위해서는 스크린 세로 줄 마다 한개의 레이를 쏴서 그걸로 텍스쳐 그림.
-> 재귀적으로 찾는 과정에서 복잡한 섹터 때문에 기록을 보관하는데 오버헤드 발생 (특히 계단 - 서로 포함하는 겹친 섹터, 계단 단차)

   - 포털 DFS(둠 초기 프로토타입): 섹터‑포털을 재귀 탐색했으나 계단처럼 중첩된 섹터에서 중복 방문 폭발.

- 새 방식
BSP 이진 공간 분할법 활용
   - BSP. 맵의 기존 벽선을 이용해 볼록 영역(subsector)을 만듦
주어진 공간을 구성하는 방향이 있는 선을 가지고 공간을 볼록하게 분할하여 하위 섹터로 분리한다.
분리한 섹터가 가장 효율적으로 분할되게 하여 일을 저장한다.
분할된 섹터를 토대로 현재 관찰자 위치가 분할 선의 어느편에 있는지를 판정해서 그리는 순서를 정한다.
순회과정에서 항상 같은 양의 순회만 있으면 되기에 효율적이다.

- Affine 텍스처 맵핑과 Projection 텍스쳐 맵핑
사실 책만 봤을 땐 그림만 보고 도대체 뭐가 다르지? 하면서 이해가 안되었다.
https://www.youtube.com/watch?v=RyYEGdGwnFs
- 화면 좌표 (x′,y′) = (x/z, y/z). 텍스처 좌표도 (u/z, v/z)를 보간해야 뒤틀림이 없다.
이런 영상을 찾아보고나서야 아 z가 화면에서 비선형응로 변한다는 것을 대충 이해했고
따라서 원근을 표현하기 위해서는 한번 더 교정해야 한다는 것을 배웠다.

