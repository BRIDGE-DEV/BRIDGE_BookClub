## 5장 테스트 주도 개발

TDD가 무언인지 이해하려면 먼저 테스트 코드를 이해하는 것이 좋은데, 여기서 모든 내용을 설명하기 보다 직접 읽어보는 걸 추천

또 다시 등장한 켄트 벡 선생님..

기억하기론 자바 유닛 테스트 코드 프레임 워크를 비행기에서 만드신 분? 으로 기억한다.

코드를 짜면서 자동으로 테스트 코드를 돌리며 리팩터링과 구현을 같이 가져간다면 확실히 효과적일 것 이라는 생각이다.

### 배심원 등장

- 배심원 등장
- 논란은 끝났다.
- GOTO는 해롭다.
- TDD는 잘 돌아간다.

TDD에 관한 논쟁은 지금도 뜨거운 감자인데, TDD 신봉자분들이 많아서 쉽게 말하지 못하겠지만, 해본적도 없어서 내가 뭘 말할 수가 없다.

하지만 하나는 명확하게 말할 수 있다.

어떠한 개발 방법론도 정답이 아니다.

당시 시대와 환경에 맞춰 유행에 불과할 뿐 개발의 본질은 크게 변하지 않으며 계속 변해간다.

몇 십년 뒤에 등장한 새로운 개발 방식에 대해서 시도해보지도 않고 TDD가 맞아! 하는 포지션보다 직접 해보고 장점과 단점을 비교하고 뭐가 더 유리한지 판단하는 것이 더 중요하다.

쉽게 확증편향, 교조주의 풀어서 책 한권만 읽은 사람이 제일 무섭다라는 말로 해석할 수 있다.

반대로 TDD가 이렇게 사랑받는 이유는 분명히 존재할 것 이므로..

### TDD의 세 가지 법칙

1. 실패한 단위 테스트를 만들기 전에는 제품 코드를 만들지 않는다.
2. 컴파일이 안 되거나 실패한 단위 테스트가 있으면 더 이상의 단위 테스트를 만들지 않는다.
3. 실패한 단위 테스트를 통과하는 이상의 제품 코드는 만들지 않는다.

이 세 가지 법칙을 지키면 반복 주기는 대략 30초 길이를 유지한다.

처음에는 작은 단위 테스트를 만들며 진행한다.

하지만 몇 초가 지나지 않아 아직 만들지도 않은 클래스나 함수의 이름을 써야 하고, 그 때문에 단위 테스트는 컴파일 되지 않는다.

따라서 테스트가 컴파일되도록 제품 코드를 만들어야 한다.

하지만 그 이상의 제품 코드를 만들면 안 되기 때문에 단위 테스트를 더 만들기 시작한다.

거듭해서 주기를 반복한다.

테스트를 조금 추가한다.

제품 코드도 추가한다.

두 가지 흐름이 동시에 자라나 상호 보완하는 컴포넌트가 된다.

항체와 항원처럼 테스트와 제품 코드가 딱 들어맞는다.

사실 이런 능력까지 가기 위해선 단위 테스트 코드를 많이 짜봐야 하고 객체지향적 사고가 충분해야 역으로 설계가 가능하다.

단순 창발성을 고려하여 미로에서 탈출 경로를 짜는 DFS알고리즘의 형태를 머리로 그리기 위해선 당연히 설계를 할 줄 알아야 한다고 생각한다.

### 수많은 혜택

#### 확신

TDD는 프로다운 규칙으로 받아들이면 테스트를 하루에 십여 개, 일주일에 수백 개, 일 년에 수천 개를 만든다.

게임으로 따지자면 확보된 시야로 자신이 걸어가는 길에 와드를 박아두어 자신의 백그라운드에 `확신`을 심어주는 것이다.

#### 결함 주입 비율

테스트가 확보되면 시간이 기하급수적으로 줄어든다.

테스트만 통과하면 출시할 수 있을 정도이다.

#### 용기

왜 나쁜 코드를 봐도 고치지 않을까?

1장에 나왔지만, 건드리는 순간 책임을 져야하기 때문이 아닐까?

아니면 내가 생각한 애정 자체가 없거나.. 스스로 프로라고 생각하지 않아서?

하지만 말끔히 정리해도 해당 기능을 망가뜨리지 않을 수 있다는 확신이 생긴다면? 테스트 코드..!

이런 믿음이 프로그래머의 개발 속도에 엄청난 영향을 준다.

#### 문서화

테스트 코드만큼 완벽한 문서화는 없다.

해당 기능을 동작하기 위한 테스트이기 때문에 프로그래머에게 인수인계를 할 때 글을 주저리 적는 것 보다 테스트 코드 자체를 이해하는 것이 더 효율적이다.

#### 설계

세 가지 법칙에 따라 테스트를 먼저 만들다 보면 딜레마에 빠진다.

어떤 코드를 만들어야 하는지 정확히 아는 데 불구하고, 법칙을 따르려다 보니 제품 코드가 없어 실패하는 단위 테스트를 먼저 만들어야 한다.

이는 만들려는 코드를 반드시 테스트해야 한다는 뜻이다.

테스트 코드를 만들려면 코드의 의존관계를 고립시켜야 한다는 어려움이 있다.

다른 함수를 호출하는 함수는 테스트하기 어려운 경우가 많다.

이 경우 테스트를 만들려면 다른 부분에서 떨어뜨리는 방법을 찾아야 한다.

다른 말로 테스트를 먼저 만들기 위해서는 좋은 설계를 고민해야 한다.

#### 프로다운 선택

최종 결론은 TDD는 프로다운 선택이라는 사실이다.

TDD는 확신, 용기, 오류 감소, 문서화, 설계를 향상시키는 원칙이다.

### TDD와 관련 없는 사실

TDD는 마법이 아니다. (은총알이 아니다.)

### 느낀점

테스트코드의 중요성은 사실 작은 프로젝트에선 보기 힘들다.

엔트로피가 증가함에 따라 기하급수로 증가하는 버그나 투자 시간을 경험해보면 절실해지는 것 같다.

TDD는 좋은 선택이라는 것도 잘 알지만, 지금 내 수준에선 테스트 코드에 대한 경험이 먼저라고 판단된다.

#### 논의사항

- 나쁜 코드라고 생각하고 지나치신 경험이 있다면 이유가 무엇인가요?

저는.. 이제는 그렇지 않겠지만 당시에는 feature를 빠르게 보여주기 위해서 넘어갔던 것 같습니다.

결국엔 다시 저에게 레거시로 돌아와 그만큼을 넘는 시간을 투자해야 했지만..
