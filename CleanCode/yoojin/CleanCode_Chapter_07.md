# 7장 오류 처리

## 느낀점
실험 코드를 짜면서 오류 처리에 대한 부분을 고민하지 않았던 것 같다. 오히려 코드를 돌려보면서 발견하는 오류들에 대한 코드들을 수정하고 넘겼던 기억이 있는데, 이번 장을 읽으면서 오류 처리를 하는 것이 코드를 깔끔하게 작성할 수 있으며, 대부분의 케이스도 같이 고려하고, 테스트 케이스를 구현할 때도 도움이 된다는 것을 알게 되었다.

## 논의사항
오류 처리 관련하여, 모두들 테스트 케이스를 진행하면서 생기는 오류들을 처리하시는 편인가요? 어떤 경우에 오류를 보통 처리하시는 지 궁금합니다!


## 내용 요약
오류 처리는 프로그램에 반드시 필요한 요소 중 하나이다. 깨끗한 코드와 오류 처리는 연관성이 존재한다. 오류 처리는 중요하지만, 오류 처리 코드로 인해 프로그램 논리를 이해하기 어려워진다면 깨끗한 코드라고 부르기 어렵다. 

**오류 코드보다 예외를 사용하라.**

오류가 발생하면 예외를 던져서, 코드를 확실히 깨끗하게 만든다. 

**Try-Catch-finally 문 부터 작성하라.**

try 블록은 트랜잭션과 비슷하다. try 블록에서 무슨일이 생기든지 catch 블록은 프로그램 상태를 일관성 있게 유지해야 한다. try-catch 구조로 예외의 유형을 좁혀 범위를 정의한다. 

    → 구현하는 방법 : 먼저 강제로 예외를 일으키는 테스트 케이스를 작성한 후 테스트를 통과하게 코드를 작성하는 방법을 사용한다. 

그러면 자연스럽게 try 블록의 트랜잭션 범위부터 구현하게 되므로, 범위 내에서 트랜잭션 본질을 유지하기 쉬워진다.

**미확인 예외를 사용하라.**

확인된 예외는 <U>OCP (Open Closed Principle)</U>을 위반한다. 메서드에서 확인된 예외를 던졌는데, catch 블록이 세 단계 위에 있다면 그 사이 메서드 모두가 선언부에 해당 예외를 정의해야 한다. 최하위 단계의 함수를 변경하여 새로운 예외를 처리해야 할 때, 최상위 단계까지의 연쇄적인 수정이 일어날 때, throws 경로에 위치한 모든 함수가 최하위 함수의 예외를 모두 알고 있어야 하므로 캡슐화가 깨진다. 그러므로, 미확인 예외를 사용하라는 말이다. 

중요한 라이브러리를 작성할 때는, 모든 예외를 잡을 필요가 있으므로, 확인된 예외도 중요하다.

**예외에 의미를 제공하라.**

오류 메시지에 정보를 담아 예외와 함께 던진다. 실패한 연산 이름과 실패 유형도 언급한다. 

**호출자를 고려해 예외 클래스를 정의하라.**

오류를 분류하는 방법은 굉장히 많다. 애플리케이션에서 오류를 정의할 때 가장 중요한 부분은 오류를 잡아내는 부분이다. 감싸기 클래스를 이용하여, 외부 API와의 의존성을 줄여준다. 예외 클래스가 하나만 있어도 충분한 코드가 많다. 예외 클래스에 포함된 정보로 오류를 구분해도 괜찮은 경우가 포함된다. 또한, 한 예외는 잡아내고 다른 예외는 무시해도 괜찮은 경우라면 여러 예외 클래스를 사용한다.

**정상 흐름을 정의하라.**

특수 사례 패턴 (Special case pattern)

>클래스를 만들거나 객체를 조작해 특수 사례를 처리하는 방식. 클래스나 객체가 예외적인 상황을 캡슐화해서 처리하므로, 클라이언트 코드가 예외적인 상황을 처리할 필요가 없어짐.

**null을 반환하지 마라.**

null을 반환하는 코드는 일거리를 늘릴 뿐만 아니라 호출자에게 문제를 떠넘긴다. 메서드에서 null을 반환하고 싶은 유혹이 든다면 대신 예외를 던지거나 특수 사례 객체를 반환한다. 

```jsx
List<Employee> employee = getEmployees();
if (employee != null){
	for(Employee e: employee) {
		totalPay += e.getPay()
	}
}
해당 코드를 아래와 같이 바꿔본다.
```

```jsx
List<Employee> employee = getEmployees();
for(Employee e: employee) {
	totalPay += e.getPay()
}
```

**null을 전달하지 마라.**

메서드로 null을 전달하는 방식은 최대한 피하자.

assert 문 등을 통해 null에 대한 처리는 가능하지만, 문제를 해결하지는 못한다. 즉, 누군가 null을 전달하면 여전히 실행 오류가 발생한다. 그럴 떄는 인수로 null을 넘기지 못하도록 금지하는 정책을 하는 것이 중요하다.

### 마치는 글

깨끗한 코드는 안정성이 높아야 한다. 오류를 잘 처리하고, 프로그램 논리와 분리하면 독립적인 추론이 가능해지며, 코드 유지보수성도 높아진다.