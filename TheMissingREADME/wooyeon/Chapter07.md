# 필독! 개발자 온보딩 가이드

## 7장. 올바로 주고받는 코드 리뷰

> 원활한 팀 협업과 높은 코드 품질을 목표로

대부분의 팀은 변경한 코드를 머지하기 전에 리뷰를 진행한다. 고품질 코드 리뷰 문화를 갖추는 것은 엔지니어 수준과 관계없이 모두가 함께 성장하며 코드베이스에 대한 이해를 서로 공유하는 데 도움이 된다.

<br>

### 코드 리뷰는 왜 필요한가

잘 수행된 코드 리뷰는 엄창난 가치를 지닌다. 버그를 찾아내고 코드를 깔끔하게 유지할 수 있다는 표면적이지만 명확한 장점도 있는 한편, 자동화된 테스트나 린터 외에도 사람이 개입을 한다는 것 이상의 가치를 지닌다. 좋은 리뷰는 교육 도구처럼 동작하며, 인식을 확산시키고, 구현 결정사항을 문서화하며, 보안 및 규정 준수와 관련해 변경 기록을 제공한다.

코드 리뷰는 팀의 교육 및 학습 도구로서의 역할을 수행한다. 다른 사람의 피드백을 통해 새로운 것을 배울 수 있기 때문이다. 여러분이 미처 알지 못했던 유용한 라이브러리나 코딩 기법을 리뷰어가 알려줄 수도 있다. 팀의 코딩 스타일을 배울 수 있는 손쉬운 방법이기도 하다.

코드베이스 변경을 리뷰한다는 것은 곧 두 명 이상의 엔지니어가 한 줄 한 줄 모든 프로덕션 코드를 숙지한다는 의미다. 여러분이 변경하는 것이 무엇인지를 아는 사람이 주변에 있다는 것은 뭔가 잘못된 일이 발생해도 팀에서 그 문제를 해결할 수 있는 사람이 여러분만은 아니라는 뜻이기도 하다.

리뷰의 댓글 기록은 코드를 왜 이렇게 작성했는지 설명하는 문서로서의 역할도 수행한다. 코드 리뷰는 세부 구현에 대한 결정 과정의 기록으로 활용할 수 있다. 예전의 코드 리뷰를 살펴볼 수 있단느 것은 문서화된 이력을 개발자가 볼 수 있다는 뜻이다.

리뷰는 보안 및 규정 준수 목적으로도 필요하다. (악의적으로 코드베이스 수정하는 것 방지)

코드 리뷰의 이 모든 장점은 모든 참여자가 '신뢰도 높은' 환경에서 업무를 진행할 때에야 비로소 드러난다. 즉 리뷰어는 유용한 피드백을 제공하려 노력하고 리뷰를 받는 사람은 피드백을 받을 준비가 된 환경이 마련돼야 한다. 형편없는 코드 리뷰는 유해한 장애물이 된다. 무심한 피드백은 아무런 가치를 제공하지 못할 뿐더러 개발 속도를 더디게 만든다. 리뷰를 제때 진행하지 않아 코드 변경이 중단되는 일도 생긴다. 올바른 코드 리뷰 문화가 구축되지 않으면 개발자들의 의견이 가차 없이 충돌해 팀을 망가뜨린다.

<br>

### 코드 리뷰를 제대로 받는 방법

코드가 변경되는 과정을 보면, 우선 필요한 코드를 변경하고 이를 제출한 후 리뷰를 거쳐 최종 승인을 받아 머지하는 절차로 이뤄진다. 개발자는 먼저 코드 제출 준비를 하는 것부터 시작한다. 일단 코드가 준비되면 변경사항을 제출하고 '리뷰 요청'을 생성한다. 그러면 리뷰어에게 알림이 전해진다. 리뷰어로부터 피드백을 받으면 이런저런 논의가 이뤄지고 그에 따라 추가적인 변경이 발생한다. 그런 다음 변경된 코드가 승인을 얻으면 코드베이스에 머지된다.

<br>

#### 코드 리뷰를 받을 때 준비해야 할 사항

잘 준비된 리뷰 요청은 여러분이 어떤 작업을 했는지 다른 개발자가 쉽게 이해하고 건설적인 피드백을 줄 수 있게 만들어진다. 리뷰를 요청한 코드에 너무 연연해서는 안 된다. 리뷰를 거치는 동안 얼마든지 코드가 수정될 수도 있다는 점, 때로는 상당히 많이 수정될 수도 있다는 점을 명심하자.

제목과 설명을 작성하고 리뷰어를 추가한 다음, 수정한 코드가 해결하고자 하는 이슈에 대한 링크를 추가하자. 제목과 설명은 커밋 메시지와는 다르다. 리뷰 요청의 제목과 설명에는 변경사항의 테스트 방법, 다른 자료에 대한 링크, 구현 상세에 대한 도움 요청이나 질문 등 추가적인 배경 설명이 포함돼야 한다.

<br>

#### 리뷰 초안이 있으면 위험을 낮출 수 있다

변경 초안 draft change은 테스트 작성, 코드 정리, 문서 추가 등에 많은 시간을 할애하지 않고도 변경사항을 검토하고 제안할 수 있는 좋은 방법이다. 리뷰 초안 draft review을 제출해서 지금 하고 있는 일의 방향이 맞는지 확인할 수 있다. 리뷰 초안이란 팀원으로부터 신속하게 피드백을 얻을 목적으로 요청하는 비공식 리뷰로서, 이를 잘 이용하면 엉뚱한 방향으로 업무를 진행할 위험이 줄어든다.

리뷰 초안을 준비할 때는 코드 리뷰 요청이 아직 초안이거나 변경사항이 아직 '작업 중 work-in-progress(wip)'이라는 표시를 해야 혼란이 없다. 깃허브에서는 'Draft PR'이라는 기능을 제공한다. 일단 초안으로 제출한 코드 리뷰가 올바른 방향으로 진행되는 것 같으면 구현과 테스트, 문서화를 마무리하고 최종적으로 코드를 다듬은 뒤 '초안' 상태를 제거하면 된다. 변경사항이 완성 단계에 이르면 리뷰할 준비가 됐음을 명확히 표시하고 앞 절에서 설명한대로 리뷰 요청을 준비하기 바란다.

<br>

#### 테스트 실행을 위한 리뷰 제출은 금물이다

테스트를 실행할 목적으로 코드 리뷰를 제출하는 것은 낭비다. 그러면 테스트 큐queue가 가득 차서 정작 머지 전에 테스트를 실행해야 하는 다른 리뷰를 방해하기도 한다. 또한 다른 팀원들이 여러분의 리뷰를 반드시 검토해야 하는 것으로 착각할 수도 있다.

<br>

#### 코드 변경사항이 많을 때는 좀 더 면밀하게

변경한 코드가 많으면 다른 사람에게 설명하는 시간(코드 워크스루)을 갖자. 즉 개발자가 화면을 공유하고 팀원들을 대상으로 어떤 코드를 왜 변경했는지 설명하는 회의를 여는 것이다. 그러면 팀이 여러분의 변경사항을 더 잘 이해하고 아이디어가 있다면 공유해줄 수도 있다.
_(코드 워크스루 유사한 것을 가진 적은 있는 듯)_

주의할 점은 회의 중에 팀원이 실제로 코드를 리뷰해서는 안된다는 것이다. 참석자는 코드 리뷰 시에 꼭 댓글로 남겨야 한다. 회의를 여는 목적은 왜 여러분이 코드를 이런 식으로 변경했는지를 팀 전체가 이해하며 나중에 각자 코드를 리뷰할 때 도움이 될 멘탈 모델을 제시하는 것이어야 한다.

<br>

#### 자신의 코드에 너무 집착하지 말자

코드에 비판적인 의견이 달리는 것은 견디기 어려운 일이다. 그렇다고 그런 의견을 너무 감정적으로 받아들여서는 안된다. 리뷰는 코드에 대한 것이지, 여러분에 대한 의견이 아니다. 사실 코드도 여러분의 코드가 아니다. 나중에는 전체 팀이 코드를 담당하게 된다. 코드에 의견 댓글이 수없이 달리는 상황은 지극히 정상이며 특히 여러분이 팀에서 가장 경험이 적은 개발자라면 더욱 그렇다.

다른 사람의 피드백은 되도록 받아들이고 그에 따라 코드를 바꿀 수도 있다는 점을 인지해두자.

<br>

#### 공감력을 갖되 무례함은 참지 말자

(남의 무례함은 참지 말자는 것)
리뷰어에게 의심할 수 있는 자유는 허락하되, 리뷰어의 댓글이 요점을 벗어나거나 무례한 경우에는 사실대로 알려주자. 논의가 길어지거나 요점을 벗어난다면 직접 얼굴을 맞대로 얘기하는 편이 환기도 되고 문제 해결에도 도움이 된다. 만일 불편하게 느껴진다면 여러분의 팀장에게 이야기하자.

본인 자신부터 살펴보자. 단지 여러분이 작성한 코드기 때문에 본능적으로 스스로 방어적인 태도를 취하는 것일까, 아니면 실제로 여러분의 방식이 더 낫기 때문일까? 여러분 스스로의 시각을 명확히하자.

코드 리뷰 과정에서 발생하는 충돌을 해소하는 방법은 팀마다 다르다. 리뷰를 요청한 사람에게 맡길 수도, 기술 리드에게 맡길 수도, 또 다른 팀에서는 다수결로 결정할 수도 있다. 팀의 규정을 따르자.

_(우리 팀은 리뷰를 요청한 사람에게 맡긴다.. 인디게임은 대부분 그럴 것 같다)_

<br>

#### 주도적으로 행동하자

다른 사람에게 여러분의 코드를 리뷰해달라고 부탁하는 일을 너무 부끄러워 하지 말자. 속도가 빠른 프로젝트에서는 리뷰를 놓치는 경우도 있으므로 아무런 피드백을 받지 못했다면 팀에게 확인해보자. 의견을 받으면 즉시 응답하다. 모든 이의 기억에는 한계가 있으므로 여러분이 신속하게 응대할수록 그만큼 빠르게 답변을 받을 것이다.

리뷰어에게 승인을 받으면 즉시 변경사항을 머지하자. 승인을 받은 코드 리뷰를 그냥 내버려두는 것은 사려깊지 못한 행동이다.

<br>

### 코드 리뷰를 제대로 해주는 방법


#### 리뷰 요청을 선별하자

리뷰 요청의 중요도를 판단하자. 변경의 규모와 복잡도 역시 고려할 부분이다. 만일 변경 규모가 작고 직관적이라면 팀원이 업무를 계속할 수 있도록 신속하게 리뷰해주는 편이 좋을 수도 있다.

업무 속도가 빠른 팀이라면 코드 리뷰 양이 엄청나게 많을 것이다. 변경사항을 모두 리뷰할 필요는 없다. 여러분이 뭔가 배울 수 있고 잘 알고 있는 코드를 수정하는 리뷰 요청에 집중하자.

<br>

#### 리뷰를 위한 시간을 마련하자

코드 리뷰는 운영 업부와 유사하다. 리뷰 요청을 받을 때마다 여러분이 하던 일이 중단돼서는 안 된다. 리뷰 시점을 잘 선택하지 않으면 리뷰를 하느라 오히려 여러분의 생산성이 떨어질 수 있다.

일정상에 코드 리뷰를 위한 시간을 마련해두자. 리뷰 시간을 확보해두면 좋다.

리뷰해야 할 변경사항의 규모가 크다면 리뷰 자체를 위한 이슈를 생성하자. 그리고 스프린트 계획 회의에서 해당 변경을 리뷰할 시간을 할당해두자.

<br>

#### 코드 변경사항을 이해하자

다짜고짜 의견을 남기는 식으로 리뷰해서는 안 된다. 먼저 읽어본 다음, 필요한 질문을 충분히 해보자. 코드 리뷰란 모름지기 리뷰어가 시간을 제대로 들여 변경의 목적을 이해할 때 비로소 그 가치가 발휘된다.

<br>

#### 포괄적인 피드백을 제시하자

변경의 올바름, 구현, 유지보수성, 적합성, 보안성 등에 대한 피드백을 제공하자. 스타일 가이드를 위반하는 코드나 읽기 어려운 코드, 헷갈리는 부분도 지적하자. 테스트 코드를 읽고 버그를 찾아서 코드의 올바름을 검증해보자.

여러분이 이 코드를 변경한다면 어떻게 구현할지 스스로 생각해보면서 대안을 찾아보고 트레이드오프에 대해 논의해보자. 이 변경사항에 도움이 될 만한 라이브러리와 서비스가 있는지도 생각해보자. 의견을 지나치게 간결하게 쓰지는 말자. 의견은 반드시 정중하게 표현해야 하며 제안하려는 방식과 그 이유를 잘 설명해야 한다.

<br>

#### 좋은 점은 인정하자

코드를 리뷰하다 보면 문제를 찾는 데만 급급해질 수 있지만 코드 리뷰가 항상 부정적일 필요는 없다. 좋은 점에 대해서도 의견을 남기자! 코드를 읽으면서 뭔가 새로운 것을 배웠다면 그 점을 언급하자. 문제가 있던 부분의 코드를 리팩터링해서 정리했거나 등의 부분은 긍정적으로 격려하는 의견을 남겨주자. 좋은 점을 찾을 수 없다면 원저자의 의도와 노력이라도 인정해주자.

_(이 부분은 정말 중요하게 생각하는 부분이다.)_

<br>

#### 이슈, 제안, 사소한 흠결은 잘 구분하자

리뷰 의견은 중요도가 서로 다르다. 'nit (사소한 사항)'이라는 접두어를 의견 글 앞에 붙여 사소한 일임을 명확히 표시하자. (공백 두번, 표기법, 메소드 이름 등)

_(이렇게 리뷰 레벨 간단하게라도 나누면 좋을 듯)_

동일한 스타일 이슈가 반복적으로 발생하는 경우 계속 지적할 필요는 없다. 맨 처음에 발견한 부분만 지적하고 동일하게 문제를 수정할 부분이 더 있다고 알려주자.

여러분이 보기에 더 나은 방법이 있다면 그 부분을 제안하되 '선택적' 또는 '승인과 무관' 같은 접두어를 이용해 표시해두는 것도 좋다. 수정이 필요한 사항과 제안사항을 구분하면 원저자가 여러분의 의도를 파악하기 수월하다.

<br>

#### 대충대충 리뷰는 금물

리뷰를 빨리 승인해야 한다는 유혹에 넘어가지 말자. 대충대충 리뷰는 오히려 해가 된다. 그로 인해 추후 여러분에게 책임이 돌아올 수도 있다.

리뷰 요청을 대충 승인하고 싶은 생각이 든다면 그 리뷰 요청에 포함된 변경이 너무 크기 때문일지도 모른다. 코드 리뷰의 규모가 크면 더 작은 크기로 나눠달라고 부탁하자. 개발자가 작업을 하다 보면 수천 줄의 변경을 한 번에 몰아넣기 일수다. _(ㅇㅈ)_

<br>

#### 웹 기반 리뷰 도구에만 의존하지는 말자
#### 테스트 리뷰도 잊지 말자

코드의 유지보수와 간결함을 위해 테스트를 반드시 확인하자.

<br>

#### 어떻게든 결론을 맺어야 한다

개선사항을 너무 오래 질질 끌지는 말자. 리뷰 요청자가 신속히 승인을 받을 수 있게 도와주자. 지나치게 완벽을 추구하지는 말고 변경의 범위를 확장하지 말며 어떤 댓글이나 의견이 중요한지 명확히 묘사하고 서로 동의하지 않는 부분이 곪아 터지지 않도록 주의하자.

리뷰 상태를 '변경 요청'이나 '승인'으로 표시해서 리뷰를 완료할 수 있다. 리뷰에 댓글을 많이 달았다면 리뷰 요약을 제공하는 것이 도움이 된다. 변경을 요청하는 경우에는 다음과 같이 특히 어떤 부분을 더 개선해야 하는지를 명확하게 하자.

<br>

### 개발자의 필수 체크리스트

![image](https://github.com/BRIDGE-DEV/BRIDGE_BookClub/assets/80298207/cabe0cfe-fc4a-4e0c-912e-5560854559e2)

<br>

### 생각

이 장은 앞부분은 회사에 들어간 이후에 다시 읽어보면 좋을 것 같고, 뒷부분은 현재의 나에게도 충분히 도움이 되었다.
리팩터링과 코드 리뷰가 하고 싶어지는 장이었다...

### 논의사항

_다른 분들의 코드 리뷰 방식이 궁금했는데 다른 분들도 마찬가지시네요 ㅋㅋ_

일단 저희 팀은 깃허브로 코드 리뷰를 하는데 처음에는 올라간 PR을 모두 확인하는 방식으로 했습니다..
(이번 팀에서 코드 리뷰를 처음 접해서 압박감이 있기도 했습니다 ㅠㅠ)

저는 제 페어 프로그래머가 저보다 실력이 뛰어났기 때문에 다른 프로그래머의 의견을 듣거나 다른 프로그래머의 코드에 대한 질문을 하거나 코드를 읽어보며 새로운 정보를 얻는 등의 받는(?) 리뷰가 많았던 것 같습니다.
종종 더 나을 것 같은 방식을 제안하거나 코드 컨벤션에 어긋난 부분을 이야기 하기도 했습니다.

페어 프로그래머가 다른 일을 하고, 새 프로그래머가 들어온 이후로 코드 리뷰 문화가 잘 전달 안되기도 하고, 바빠져서 코드리뷰를 거의 못했습니다.
반성하고 있습니다...