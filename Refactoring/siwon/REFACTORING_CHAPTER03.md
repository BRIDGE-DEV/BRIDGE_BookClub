# REFACTORING_CHAPTER03

# 코드에서 나는 악취

## 내용 정리

---

### 기이한 이름(Mysterious Name)

마땅한 이름이 떠오르지 않는다면 설계에 더 근본적인 문제가 숨어있을 가능성이 높다. 
그래서 **혼란스러운 이름을 잘 정리하다 보면 코드가 훨씬 간결해질 때가 많다.**

### 긴 함수(Long Function)

**코드를 이해하고, 공유하고, 선택하기 쉬워진다는 장점은 함수를 짧게 구성할 때 나오는 것이다.**

예전 언어는 서브루틴을 호출하는 비용이 컸기 때문에 짧은 함수를 꺼렸다. 하지만 요즘 언어는 프로세스 안에서의 함수 호출 비용을 거의 없애버렸다. 물론 코드를 읽는 사람 입장에서는 함수가 하는 일을 파악하기 위해 왔다 갔다 해야 하므로 여전히 부담이 된다. 다행히 함수 호출부와 선언부 사이를 빠르게 이동하거나 호출과 선언을 동시에 보여주는 개발 환경을 활용하면 이 부담이 줄어들지만, 짧은 함수로 구성된 코드를 이해하기 쉽게 만드는 가장 확실한 방법은 좋은 이름이다. 

함수 이름은 동작 방식이 아닌 '의도'가 드러나게 짓는다. **함수 이름을 잘 지어두면 본문 코드를 볼 이유가 사라진다. 그러기 위해서는 훨씬 적극적으로 함수를 쪼개야 한다.**

예전 언어는 서브루틴을 호출하는 비용이 컸기 때문에 짧은 함수를 꺼렸다. 하지만 요즘 언어는 프로세스 안에서의 함수 호출 비용을 거의 없애버렸다.

### 뒤엉킨 변경(Divergent Change)

SRP가 제대로 지켜지지 않을 때 나타난다. 
즉, 하나의 모듈이 서로 다른 이유들로 인해 여러가지 방식으로 변경되는 일이 많을 때 발생한다.

### 산탄총 수술(Shotgun Surgery)

비슷하면서도 정반대다. 변경할 부분이 코드 전반에 퍼져있다면 찾기도 어렵고 꼭 수정해야 할 곳을 지나치기 쉽다.

|  | 뒤엉킨 변경(Divergent Change) | 산탄총 수술(Shotgun Surgery) |
| --- | --- | --- |
| 발생과정 | 한 코드에 섞여 들어감 | 여러 코드에 흩뿌려짐 |
| 해법 | 맥락별로 분리 | 맥락별로 모음 |

### 기능 편애(Feature Envy)

어떤 함수가 자기가 속한 모듈의 함수나 데이터보다 다른 모듈의 함수나 데이터와 상호작용할 일이 더 많을 때 풍기는 냄새다. 함수가 데이터와 가까이 있고 싶어한다는 의중이 뚜렷이 드러나므로 소원대로 데이터 근처로 옮겨주면 된다. 

함수가 사용하는 모듈이 다양하다면 어느 모듈로 옮겨야할까? 이럴 때는 가장 많은 데이터를 포함한 모듈로 옮긴다. 함수 추출하기로 함수를 여러 조각으로 나눈 후 각각을 적합한 모듈로 옮기면 더 쉽게 해결되는 경우도 많다.

### 데이터 뭉치(Data Clumps)

판별하려면 값 하나를 삭제해보자. 나머지 데이터만으로는 의미가 없다면 객체로 환생하길 갈망하는 데이터 뭉치라는 뜻이다.

### 기본형 집착(Primitive Obsession)

전화번호를 단순히 string 집합으로만 표현하기엔 아쉬움이 많다. 최소한 사용자에게 보여줄 때는 일관된 형식으로 출력해주는 기능이라도 갖춰야 한다. 이런 자료형들을 문자열로만 표현하는 악취는 아주 흔해서, 소위 ‘stringly typed' 변수라는 이름까지 붙었다.

### 성의없는 요소(Lazy Element)

본문 코드를 그대로 쓰는 것과 진배없는 함수도 있고, 실질적으로 메서드가 하나뿐인 클래스도 있다. 

이런 구조는 나중에 본문을 더 채우거나 다른 메서드를 추가할 생각이었지만, 어떠한 사정으로 인해 그렇게 하지 못한 결과일 수 있다. 사정이 어떠하든 이런 프로그램 요소는 고이 보내드리는 게 좋다. 이 제거 작업은 **흔히 함수 인라인하기**나 **클래스 인라인하기**로 처리한다.

### 추측성 일반화(Speculative Generality)

 '나중에 필요할 거야'라는 생각으로 당장은 필요없는 모든 종류의 후킹(hooking) 포인트와 특이 케이스 처리 로직을 작성해둔 코드에서 풍긴다. 그 결과는 이해하거나 관리하기 어려워진 코드다. 당장 걸리적거리는 코드는 눈앞에서 치워버리자.

클래스가 제공하는 메서드 중 절반이 다른 클래스에 구현을 위임하고 있다면 어떤가? 이럴 때는 **중개자(Middle Man) 제거하기**를 활용하여 실제로 일을 하는 객체와 직접 소통하게 하자. 위임 메서드를 제거한 후 남는 일이 거의 없다면 호출하는 쪽으로 인라인하자.

### 주석(Comments)

주석이 장황하게 달린 원인이 코드를 잘못 작성했기 때문인 경우가 의외로 많다.
**주석을 남겨야겠다는 생각이 들면, 가장 먼저 주석이 필요없는 코드로 리팩터링해본다.**

### 중복 코드(Duplicated Code)

코드가 비슷하긴한데 완전히 똑같지는 않다면 
먼저 **문장 슬라이드하기**로 비슷한 부분을 한 곳에 모아 **함수 추출하기**를 더 쉽게 적용할 수 있는지 살펴본다.

## 느낀 점

---

제가 봐왔던 모든 오류들이 정리 되어있고 이름이 다 붙여져 있었다는 사실에 놀랍습니다. 이 챕터에 있는 내용을 제 코드에 접목시켜 고쳐나가보고 싶네요..! 이 챕터에는 구체적인 예시가 따로 없어서 아쉽긴 합니다.

## 논의 내용

---

의도치 않게 코드 악취를 만들어본 경험이 있나요?