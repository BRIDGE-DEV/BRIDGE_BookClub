# 객체지향의 사실과 오해

## 7장. 함께 모으기

> 코드와 모델을 밀접하게 연관시키는 것은 코드에 의미를 부여하고 모델을 적절하게 한다 -에릭 에반스

마틴 파울러는 객체지향 설계 안에 존재하는 세 가지 상호 연관된 관점에 관해 설명한다.

- **개념 관점**에서 설계는 도메인 안에 존재하는 개념과 개념들 사이의 관계를 표현한다.
    - 사용자가 도메인을 바라보는 관점 반영
    - 실제 도메인의 규칙과 제약을 최대한 유사하게 반영하는 것이 핵심
- **명세 관점**에 이르면 사용자의 영역인 도메인을 벗어나 개발자의 영역인 소프트웨어로 초점이 옮겨진다.
    - 객체의 인터페이스를 바라보게 됨
    - 객체가 협력을 위해 '무엇'을 할 수 있는가
    - "구현이 아니라 인터페이스에 대해 프로그래밍 하라"는 명세 관점과 구현 관점을 분리하는 것에서 시작됨
- **구현 관점**은 프로그래머에게 가장 익숙한 관점으로, 실제 작업을 수행하는 코드와 연관돼 있다.
    - 객체들이 책임을 수행하는 데 필요한 동작 코드를 작성
    - 객체의 책임을 '어떻게' 수행할 것인가
    - 인터페이스를 구현하는 데 필요한 속성과 메서드를 클래스에 추가

세 관점은 순서가 아닌, 동일한 클래스를 바라보는 세 가지 방향이다.

클래스는 세 가지 관점이라는 안경을 통해 설계와 관련된 다양한 측면을 드러낼 수 있다.

- 클래스가 은유하는 개념은 도메인 관점을 반영한다.
- 클래스의 공용 인터페이스는 명세 관점을 반영한다.
- 클래스의 속성과 메서드는 구현 관점을 방영한다.

이것은 클래스를 어떻게 설계해야 하느냐에 대한 중요한 힌트를 암시한다.

클래스는 세 가지 관점을 모두 수용할 수 있도록 개념, 인터페이스, 구현을 함께 드러내야 한다.

동시에 코드 안에서 세 가지 관점을 식별할 수 있도록 깔끔하게 분리해야 한다.

협력 안에서 메시지를 선택하고 메시지를 수신할 객체를 선택하는 것은 객체의 인터페이스, 즉 명세 관점에서 객체를 바라보는 것이다.


(목표
1. 도메인 모델에서 시작해서 최종 코드까지의 구현 과정을 간략하게나마 설명
2. 구현 클래스를 개념, 명세, 구현 관점에서 바라본다는 것이 무엇을 의미하는지를 설명)

### 커피 전문점 도메인

#### 커피 주문

(예제: 커피 전문점에서 커피를 주문하는 과정)

*왜 에스프레소가 아메리카노보다 비싸지.. 투샷인가*

#### 커피 전문점이라는 세상

객체지향의 관점에서 커피 전문점이라는 도메인은 손님 객체, 메뉴 항목 객체, 메뉴판 객체, 바리스타 객체, 커피 객체로 구성된 작은 세상이다.

- 손님은 메뉴판에서 주문할 커피를 선택할 수 있어야 한다. (손님 - 메뉴판 관계 존재)
- 손님은 바리스타에게 주문을 한다. (손님-바리스타 관계 존재)
- 바리스타는 커피를 제조한다. (바리스타-커피와 관계 존재)

- 손님 객체는 '손님 타입'의 인스턴스,
- 바리스타 객체는 '바리스타 타입'의 인스턴스,
- 네 가지 커피는 '커피 타입'의 인스턴스,
- 메뉴판 객체는 '메뉴판 타입'의 인스턴스,
- 네 개의 메뉴 항목 객체는 '메뉴 항목 타입'의 인스턴스

메뉴판 객체는 다수의 메뉴 항목 객체로 구성돼 있고, 이들은 따로 떨어져 존재하지 않으며 하나의 단위로 움직인다. => 포함 관계, 합성 관계
(선으로 연결, 부모 쪽에 속이 찬 마름모, 자식 쪽에 숫자)

손님은 메뉴판 타입을 알고 있어야 원하는 커피를 선택할 수 있다. => 연관 관계
(손님과 바리스타, 바리스타와 커피도 연관 관계)
(선으로 연결)

### 설계하고 구현하기

#### 커피를 주문하기 위한 협력 찾기

객체지향 설계의 첫 번째 목표는 훌륭한 객체를 설계하는 것이 아니라 훌륭한 협력을 설계하는 것이라는 점을 잊지 말자. 훌륭한 객체는 오직 훌륭한 협력을 설계할 때만 얻을 수 있다.

협력을 설계할 때는 객체가 메시지를 선택하는 것이 아니라 메시지가 객체를 선택하게 해야 한다. 메시지를 먼저 선택하고 그 후에 메시지를 수신하기에 적절한 객체를 선택해야 한다는 것을 의미한다.

메시지를 화살표로 표현하고, 메시지 위의 화살표(시작점에 빈 동그라미가 있는)를 통해 인자를 전달할 수 있다.

메시지를 찾았으니 메시지를 처리하기에 적합한 객체를 선택해야 한다. 소프트웨어 객체는 현실 객체의 은유라는 것을 기억하자.

책임을 수행하기에 적합한 타입이 존재하는지 => 적절한 타입을 발견했다면 책임을 수행할 객체를 그 타입의 인스턴스로 만들기 (=> 현실 객체와 유사한 이름 붙이기) 

#### 인터페이스를 정리하기

객체가 수신한 메시지가 객체의 인터페이스를 결정한다는 사실을 기억하라.

메시지가 객체를 선택했고, 선택된 객체는 메시지를 자신의 인터페이스로 받아들인다.
(메시지만 추려내면 객체의 인터페이스가 된다.)

객체가 어떤 메시지를 수신할 수 있다는 것은 그 객체의 인터페이스 안에 메시지에 해당하는 오퍼레이션이 존재한다는 것을 의미한다.
(손님 객체의 인터페이스 안에는 '커피를 주문하라'라는 오퍼레이션이 포함돼야 한다.)

소프트웨어의 구현은 동적인 객체가 아닌 정적인 타입을 이용해 이뤄진다.

따라서 객체들을 포괄하는 타입을 정의한 후 식별된 오퍼레이션을 타입의 인터페이스에 추가해야 한다.

객체의 타입을 구현하는 일반적인 방법을 클래스를 이용하는 것이다.
(Customer, MenuItem, Menu, Barista, Coffee 클래스)

#### 구현하기

클래스의 인터페이스를 식별했으므로 이제 오퍼레이션을 수행하는 방법을 메서드로 구현하면 된다.

구현 도중에 객체의 인터페이스는 변경될 수 있다.

객체의 속성은 캡슐화되어야 하며, 이는 인터페이스에는 객체의 내부 속성에 대한 어떤 힌트도 제공돼서는 안 된다는 것을 의미한다.

이를 위한 가장 훌륭한 방법은 인터페이스를 정하는 단계에서는 객체가 어떤 속성을 가지는지, 또 그 속성이 어떤 자료 구조로 구현됐는지를 고려하지 않는 것이다.

객체에게 책임을 할당하고 인터페이스를 결정할 때는 가급적 객체 내부의 구현에 대한 어떤 가정도 하지 말아야 한다.

객체가 어떤 책임을 수행해야 하는지를 결정한 후에야 책임을 수행하는 데 필요한 객체의 속성을 결정하라.

이것이 객체의 구현 세부 사항을 객체의 공용 인터페이스에 노출시키지 않고 인터페이스와 구현을 깔끔하게 분리할 수 있는 기본적인 방법이다.

인터페이스는 객체가 다른 객체와 직접적으로 상호작용하는 통로다.

인터페이스를 통해 실제로 상호작용을 해보지 않은 채 인터페이스의 모습을 정확하게 예측하는 것은 불가능에 가깝다.

### 코드와 세 가지 관점

#### 코드는 세 가지 관점을 모두 제공해야 한다

##### 개념 관점

소프트웨어 클래스가 도메인 개념의 특성을 최대한 수용하면 변경을 관리하기 쉽고 유지보수성을 향상시킬 수 있다.

(커피를 제조하는 과정을 변경해야 한다면? Barista라는 클래스가 현실 세계와 동일하게 커피를 제조할 것이라고 쉽게 유추 가능)

소프트웨어 클래스와 도메인 클래스 사이의 간격이 좁을수록 기능을 변경하기 위해 뒤적거려야 하는 코드의 양도 점점 줄어든다.

##### 명세 관점

명세 관점은 클래스의 인터페이스를 바라본다.

클래스의 public 메서드는 다른 클래스가 협력할 수 있는 공용 인터페이스를 드러낸다.

인터페이스를 수정하면 해당 객체의 협력하는 모든 객체에게 영향을 미칠 수밖에 없다.

객체의 인터페이스는 수정하기 어렵다는 사실을 명심하라.

최대한 변화에 안정적인 인터페이스를 만들기 위해서는 인터페이스를 통해 구현과 관련된 세부 사항이 드러나지 않게 해야 한다.

변화에 탄력적인 인터페이스를 만들 수 있는 능력은 객체지향 설계자의 수준을 가늠하는 중요한 척도다.

##### 구현 관점

구현 관점은 클래스의 내부 구현을 바라본다.

클래스의 메서드와 속성은 구현에 속하며 공용 인터페이스의 일부가 아니다.

따라서 메서드의 구현과 속성의 변경은 원칙적으로 외부의 객체에게 영향을 미쳐서는 안 된다.

이것은 메서드와 속성이 철저하게 클래스 내부로 캡슐화돼야 한다는 것을 의미한다.

##### .

개념 관점, 명세 관점, 구현 관점은 동일한 코드를 바라보는 서로 다른 관점이다.

훌륭한 객체지향 프로그래머는 하나의 클래스 안에 세 가지 관점을 모두 포함하면서도 각 관점에 대응되는 요소를 명확하게 하고 깔끔하게 드러낼 수 있다.

다른 사람이 코드를 읽으면서 세 가지 관점을 쉽게 포착하지 못한다면 세 가지 관점을 명확하게 드러날 수 있게 코드를 개선해라.

#### 도메인 개념을 참조하는 이유

어떤 메시지가 있을 때 그 메시지를 수신할 객체를 어떻게 선택하는가?

첫 번째 전략은 도메인 개념 중에서 가장 적절한 것을 선택하는 것이다.

도메인 개념 안에서 적절한 객체를 선택하는 것은 도메인에 대한 지식을 기반으로 코드의 구조와 의미를 쉽게 유추할 수 있게 한다.

여러 개의 클래스로 기능을 분할하고 클래스 안에서 인터페이스와 구현을 분리하는 이유는 변경이 발생했을 때 코드를 좀 더 수월하게 수정하길 원하기 때문이다.

소프트웨어 클래스가 도메인 개념을 따르면 변화에 쉽게 대응할 수 있다.

#### 인터페이스와 구현을 분리하라

명세 관점과 구현 관점을 분리하라.

명세 관점은 클래스의 안정적인 측면을 드러내야 한다.

구현 관점은 클래스의 불안정한 측면을 드러내야 한다.

인터페이스가 구현 세부 사항을 노출하기 시작하면 아주 작은 변동에도 전체 협력이 요동치는 취햑한 설계를 얻을 수밖에 없다.

(프로그래머 입장에서 코드를 가장 많이 접하므로 구현 관점을 가장 빈번하게 사용하겠지만, 실제로 훌륭한 설계를 결정하는 측면은 명세 관점인 객체의 인터페이스다.)

명세 관점이 설계를 주도하면 설계의 품질이 향상될 수 있다.

### 생각

모든 장 중에서 가장 내 코드를 되돌아보게 하는, 그 만큼 중요한 장인 것 같다.

리팩터링 의지를 채워주는 장이었다..

### 논의사항

> 명세 관점이 설계를 주도하면 설계의 품질이 향상될 수 있다.

- 명세 관점에 중점을 두고 잘 설계하고 계신가요?

5장에서도 메시지와 인터페이스 이야기가 나왔지만, 이번 장을 읽고 인터페이스의 중요성을 제대로 깨닫게 된 것 같습니다. 

특히 저는 이전 프로젝트들에서 구현 관점에만 초점을 두어 그렇게 수정할 게 많고, 수정하기 힘들었구나 라는 생각이 들었네요..